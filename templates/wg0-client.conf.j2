[Interface]
Address = {{ item.item.wg_ip }}/24
PrivateKey = {{ item['content'] | b64decode | replace('\n', '')}}
{% if item.item.wg_dns_enabled is defined %}
DNS = {{ wg_subnet.server_ip }}
{% endif %}

[Peer]
PublicKey = {{ server_pubkey['content'] | b64decode | replace('\n', '')}}
Endpoint = {{ server_public_ipv4['content'] | replace('\n', '')}}:{{ wg_port }}
AllowedIPs = {{ wg_subnet.server_ip }}/32, {% if wg_subnet.allow_client_communication %}, {{ wg_subnet.server_ip }}{{ wg_subnet.cidr }}{% endif %}{% if item.item.allowed_ips is defined %}, {{ item.item.wg_allowed_ips | join(", ") }}{% endif %}{% if item.item.send_all_traffic %}, 0.0.0.0/0{% endif %}
{% if item.item.persistent_keepalive is undefined or item.item.persistent_keepalive != false %}
PersistentKeepalive = {{ item.item.persistent_keepalive | default('25') }}
{% endif %}
